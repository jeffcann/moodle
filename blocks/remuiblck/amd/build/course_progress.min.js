define(["jquery","core/ajax","core/notification","core/templates","block_remuiblck/jquery.dataTables","block_remuiblck/dataTables.bootstrap4","theme_remui/jquery-asPieProgress","theme_remui/aspieprogress"],function(e,s,a,t){var n,o={ROOT:"",TABLE:"#DataTables_Teacher",DATA_TABLE:"#DataTables_Teacher_wrapper",STUDENT_PROGRESS_ELEMENT:".student_progress_ele",STUDENT_PROGRESS_TABLE:"#wdmCourseProgressTable",COURSE_NAME:".wdm_course_name.has-student",MESSAGE_HIDDEN:"#messageidhidden",MESSAGE_AREA:"#messagearea",TOGGLE_DESCRIPTION:".toggle-desc",REVERT:"#courserevertbtn",CUSTOM_MESSAGE:".custom-message",MESSAGE_SEND:".send-message",BLOCK_PROCESSING:".block-processing"},r={GET_COURSES:function(e,a,t,n){return s.call([{methodname:"block_remuiblck_get_course_progress_list",args:{search:e,length:a,start:t,order:n}}])[0]},GET_COURSE_PROGRESS:function(e){return s.call([{methodname:"block_remuiblck_get_course_progress",args:{courseid:e}}])[0]},SEND_MESSAGE:function(e,a){return s.call([{methodname:"block_remuiblck_send_message",args:{studentid:e,messagetext:a}}])[0]}};function i(s){var a=e(o.ROOT);""!=s&&(a=a.find(s)),a.find(".pie-progress").asPieProgress({namespace:"pie-progress",speed:30,classes:{svg:"pie-progress-svg",element:"pie-progress",number:"pie-progress-number",content:"pie-progress-content"}})}function l(s,t){r.SEND_MESSAGE(s,t).done(function(s){e(o.ROOT).find(o.MESSAGE_HIDDEN).val(""),e(o.ROOT).find(o.MESSAGE_AREA).val(""),e(o.ROOT).find(".close-message").click()}).fail(function(s){a.exception(s),e(o.ROOT).find("div#analysis-chart-area").hide()})}function d(s){e("body").on("click",s+" "+o.COURSE_NAME,function(){var a=e(this).data("courseid");e(s).find(o.DATA_TABLE).hide(),function(s){r.GET_COURSE_PROGRESS(s).done(function(s){t.render("block_remuiblck/course_progress_view",s).done(function(s,a){t.replaceNodeContents(e(o.ROOT).find(o.STUDENT_PROGRESS_ELEMENT),s,a),i(o.STUDENT_PROGRESS_ELEMENT),n=e(o.ROOT).find(o.STUDENT_PROGRESS_TABLE).DataTable({scrollY:"300px",scrollCollapse:!0,paging:!1,retrieve:!0,lengthchange:!1,autoWidth:!0,scrollX:!0,search:"Fred",info:!1,language:{searchPlaceholder:"Search"},responsive:!0}),e(o.ROOT).find("div.dataTables_filter input").addClass("form-control"),e(o.ROOT).find("div.dataTables_length select").addClass("form-control"),e("html, body").animate({scrollTop:e(o.ROOT).offset().top-120},300)}).fail(function(e){console.log(e)})}).fail(function(s){e(o.ROOT).find("div#analysis-chart-area").hide()})}(a)}).on("click",s+" "+o.REVERT,function(){n.destroy(),e(s).find(o.STUDENT_PROGRESS_ELEMENT).empty(),e(s).find(o.DATA_TABLE).show(),e("html, body").animate({scrollTop:e(o.ROOT).offset().top-120},300)}).on("click",s+" "+o.CUSTOM_MESSAGE,function(){var s=e(this).data("studentid");e(o.MESSAGE_HIDDEN).val(s)}).on("click",s+" "+o.MESSAGE_SEND,function(){var a=e(s).find(o.MESSAGE_HIDDEN).val(),t=e(s).find(o.MESSAGE_AREA).val();""!=t?l(a,t):e(o.MESSAGE_AREA).focus()}).on("click",o.STUDENT_PROGRESS_ELEMENT+" "+o.TOGGLE_DESCRIPTION,function(){e(this).toggleClass("fa-plus"),e(this).toggleClass("fa-minus"),e(this).parents(o.STUDENT_PROGRESS_ELEMENT).find(".panel-body").toggleClass("show")}),e(s+" "+o.TABLE).on("order.dt",function(){i("")}),e(s+" "+o.STUDENT_PROGRESS_TABLE).on("order.dt",function(){i("")})}return{init:function(s){o.ROOT=s,e(document).ready(function(){setTimeout(function(){i(""),function(s){e(s).show().find(o.TABLE).DataTable({paging:!0,pagingType:"simple_numbers",autoWidth:!0,scrollX:!0,bPaginate:!0,bServerSide:!0,language:{searchPlaceholder:M.util.get_string("search","moodle"),emptyTable:M.util.get_string("nomatchingcourses","core_backup"),lengthMenu:M.util.get_string("show","moodle")+" _MENU_ "+M.util.get_string("entries","moodle"),paginate:{first:M.util.get_string("first","moodle"),previous:M.util.get_string("previous","moodle"),next:M.util.get_string("next","moodle"),last:M.util.get_string("last","moodle")}},ajax:function(t,n,i){e(s).siblings(o.BLOCK_PROCESSING).addClass("show"),r.GET_COURSES(t.search.value,t.length,t.start,t.order[0]).done(function(a){if(0==a.recordsTotal)return a.data=[],n(a),void e(s).siblings(o.BLOCK_PROCESSING).removeClass("show");var t,r;a.data=(t=a.courses,r=[],t.forEach(function(e){var s={};s.index='<div class="w-50" tabindex="0">'+e.index+"</div>",e.enrolledStudents>0?s.course='<div class="wdm_course_name has-student" data-courseid="'+e.id+'"><a href="javascript:void(0)">'+e.fullname+"</a></div>":s.course='<div class="wdm_course_name" data-courseid="'+e.id+'" >'+e.fullname+"</div>",s.startdate=e.startdate,s.students='<div class="w-100"><span class="w-full pl-40">'+e.enrolledStudents+"</span></div>",s.progress='<td class="w-100 px-10"><div class="pie-progress pie-progress-xs m-0 w-35" data-plugin="pieProgress" data-valuemax="50" data-barcolor="#11c26d" data-size="20" data-barsize="3" data-goal="35" aria-valuenow="'+e.percentage+'" role="progressbar" style="max-width: 35px!important;"><div class="pie-progress-content" style="z-index:2;"> </div> <span class=" progress-percent" style="margin-left: 50px;position: absolute;top: 8px;">'+e.percentage+"%</span> </div></td>",r.push(s)}),r),n(a),e(s).siblings(o.BLOCK_PROCESSING).removeClass("show")}).fail(a.exception)},columns:[{data:"index"},{data:"course"},{data:"startdate"},{data:"students",orderable:!1},{data:"progress",orderable:!1}],responsive:!0,drawCallback:function(e){i("")}})}(s),d(s)},2e3)})}}});
//# sourceMappingURL=course_progress.min.js.map
